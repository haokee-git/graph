# 图论可视化项目开发计划

根据 `doc/conf.md` 的需求，我制定了以下开发计划。我们将优先完成 Web 端和服务器代码，随后再进行 Electron 的适配。

## 阶段一：项目初始化与基础架构
1.  **初始化项目**：
    -   创建 `package.json`，配置 TypeScript + Vite + React 开发环境。
    -   安装必要依赖：
        -   UI 框架：`@mui/material` (Material Design 实现), `@emotion/react`, `@emotion/styled`。
        -   编辑器：`monaco-editor`, `@monaco-editor/react`。
        -   工具库：`uuid` (用于唯一标识), `express` (用于服务器)。
2.  **配置字体**：
    -   在全局 CSS 中引入 `fonts/BodyFont.otf` (正文) 和 `fonts/CodeFont.ttf` (代码/编辑器)。
3.  **搭建页面布局**：
    -   实现左右双栏 + 底部栏的响应式布局。
    -   **左侧**：输入与控制区（CheckBox, Monaco Editor）。
    -   **右侧**：Canvas 绘图区。
    -   **底部**：信息展示区。

## 阶段二：服务器与启动脚本
1.  **开发服务器代码**：
    -   编写 `server/index.ts`，使用 Express 托管静态资源（Vite 构建后的 `dist`）。
2.  **编写启动脚本**：
    -   编写 `scripts/start-server.ts`。
    -   实现跨平台（Windows/Linux）的后台启动逻辑（使用 Node.js `child_process` 的 `detached` 模式）。

## 阶段三：核心功能 - 物理引擎与渲染
这是本项目的核心难点，需要自研物理引擎。
1.  **物理引擎实现 (`src/engine/PhysicsEngine.ts`)**：
    -   **点 (Node)**：具有位置、速度、加速度、半径。实现点与点之间的**库伦斥力**。
    -   **边 (Edge)**：
        -   实现**胡克定律弹力**。
        -   **绳索模拟**：为了实现“弹力绳可能会弯掉”的效果，将一条边建模为由多个微小粒子组成的链（Chain），粒子间由强弹簧连接，受重力（可选）或松弛度影响，从而表现出弯曲效果。
    -   **积分器**：使用 Verlet 积分或 Euler 积分更新位置。
2.  **渲染器实现 (`src/engine/Renderer.ts`)**：
    -   使用 HTML5 Canvas API 进行绘制。
    -   绘制节点：圆形，根据标签长度自动调整半径。
    -   绘制边：
        -   单向边绘制箭头。
        -   根据物理引擎计算出的绳索粒子路径绘制平滑曲线（Bézier 或直接连线）。
        -   绘制边上的文字信息。
3.  **交互实现**：
    -   实现 Canvas 上的鼠标拖拽事件，实时更新物理引擎中的点位置。

## 阶段四：业务逻辑与状态管理
1.  **输入解析**：
    -   解析 Monaco Editor 中的文本内容。
    -   根据 `a b c` 格式提取节点和边。
    -   处理“硬性规定点数”逻辑（1~n）。
2.  **状态同步**：
    -   当文本改变时，平滑过渡图结构（保留现有节点位置，仅增删改）。
    -   处理 CheckBox 状态变更（单向/双向切换）。

## 阶段五：验证与优化
1.  运行测试，确保物理效果流畅自然。
2.  验证后台启动脚本在 Windows 下的表现。
3.  确认 UI 符合 Material Design 风格且为白色简洁主题。

待以上阶段完成后，我们将进入 Electron 开发阶段（根据您的指示等待命令）。
